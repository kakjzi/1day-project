# 테이블오더 서비스 요구사항 명세서

## 1. 프로젝트 개요

### 1.1 Intent Analysis

- **User Request**: 테이블오더 서비스 개발
- **Request Type**: New Project (Greenfield)
- **Scope**: Full-stack 웹 애플리케이션 (고객용, 관리자용 각각 구현할 것)
- **Complexity**: Moderate (실시간 통신, 다중 사용자 역할, 세션 관리)

### 1.2 기술 스택

| 구분           | 기술                                 |
| -------------- | ------------------------------------ |
| Backend        | Python + FastAPI                     |
| Frontend       | Next.js (React)                      |
| Database       | MySQL                                |
| Real-time      | Server-Sent Events (SSE)             |
| Image Storage  | 로컬 파일 시스템 (S3 전환 대비 구조) |
| Authentication | JWT Token                            |

### 1.3 배포 환경

- 개발/테스트 환경 (로컬 실행)
- 하나의 백엔드 시스템, 두개의 프론트 시스템
- 중규모 대응 (1개 매장, 10-30개 테이블)

---

## 2. 기능 요구사항

### 2.1 고객용 기능 (Customer Interface)

#### F-C01: 테이블 태블릿 자동 로그인

- 초기 설정: 매장 ID, 테이블 번호, 4자리 PIN 입력
- 로그인 정보 로컬 저장 후 자동 로그인
- 세션 유지

#### F-C02: 메뉴 조회 및 탐색

- 1단계 카테고리별 메뉴 분류
- 메뉴 정보: 메뉴명, 가격, 설명, 이미지
- 카테고리 간 빠른 이동
- 카드 형태 레이아웃, 터치 친화적 (최소 44x44px)

#### F-C03: 메뉴 옵션 선택

- 메뉴별 옵션 그룹 지원 (예: 맵기, 토핑, 사이드)
- 옵션별 추가 가격 설정
- 필수/선택 옵션 구분

#### F-C04: 장바구니 관리

- 메뉴 추가/삭제, 수량 조절
- 옵션 포함 총 금액 실시간 계산
- 로컬 스토리지 저장 (새로고침 유지)
- 장바구니 비우기

#### F-C05: 주문 생성

- 주문 내역 최종 확인
- 주문 확정 → 주문번호 표시 (5초) → 메뉴 화면 리다이렉트
- 실패 시 에러 메시지 + 장바구니 유지

#### F-C06: 주문 내역 조회

- 현재 테이블 세션 주문만 표시
- 주문 정보: 주문번호, 가게이름, 테이블번호, 시각, 메뉴/수량, 금액, 상태
- 주문 상태 4단계: 대기중 → 접수 → 준비중 → 완료

### 2.2 관리자용 기능 (Admin Interface)

#### F-A01: 매장 인증

- 매장 ID, 사용자명, 비밀번호 로그인
- JWT 토큰 기반 16시간 세션
- bcrypt 비밀번호 해싱

#### F-A02: 관리자 계정 관리

- 관리자 등록 API/화면 제공
- 매장별 관리자 계정 관리

#### F-A03: 실시간 주문 모니터링

- SSE 기반 실시간 주문 업데이트 (2초 이내)
- 테이블별 그리드/카드 레이아웃
- 테이블 카드: 총 주문액, 최근에 주문했던 내역
- 주문 카드 클릭 → 상세 보기
- 주문 상태 변경 (대기중 → 접수 → 준비중 → 완료)
- 신규 주문: 시각적 강조 + 소리 알림

#### F-A04: 테이블 관리

- 테이블 초기 설정 (번호, 4자리 PIN)
- 주문 삭제 (확인 팝업 → 즉시 삭제 → 총액 재계산, 완료 상태 제외)
- 테이블 이용 완료 (세션 종료 → 주문 이력 이동 → 리셋)
- 테이블 간 주문 이동 (고객 자리 변경 시)
- 과거 주문 내역 조회 (날짜 필터링)

#### F-A05: 메뉴 관리

- 메뉴 CRUD (메뉴명, 가격, 설명, 카테고리, 이미지)
- 메뉴 옵션 그룹 관리
- 옵션 항목 관리 (이름, 추가가격, 필수여부)
- 메뉴 노출 순서 조정
- 카테고리 관리

---

## 3. 비기능 요구사항

### 3.1 성능

- 실시간 주문 알림: 2초 이내 표시
- 페이지 로딩: 3초 이내

### 3.2 사용성

- 터치 친화적 UI (최소 44x44px 버튼)
- 한국어 기본 (다국어 구조 준비, 영어 번역은 추후)
- 직관적인 시각적 계층 구조

### 3.3 보안

- 비밀번호 안전 저장 (bcrypt 해싱)
- 관리자 세션: 16시간 유지 후 자동 로그아웃
- 테이블 인증: 4자리 숫자 PIN
- 로그인 시도 제한 (brute-force 방지)

### 3.4 데이터

- 샘플 데이터 포함 (매장, 카테고리, 메뉴, 테이블)
- 주문 이력 영구 저장

---

## 4. 제외 사항 (Constraints)

다음 기능은 이번 개발에서 제외:

- 결제 처리 (PG사 연동, 영수증, 환불, 포인트/쿠폰)
- 복잡한 인증 (OAuth, SNS 로그인, 2FA)
- 이미지 리사이징/최적화
- 푸시/SMS/이메일 알림
- 주방 전달 시스템, 재고 관리
- 데이터 분석, 매출 리포트
- 외부 연동 (배달 플랫폼, POS)

---

## 5. 데이터 모델 개요

### 5.1 핵심 엔티티

- **Store**: 매장 정보
- **Admin**: 관리자 계정
- **Table**: 테이블 정보 + 현재 세션
- **Category**: 메뉴 카테고리
- **Menu**: 메뉴 정보
- **OptionGroup**: 메뉴 옵션 그룹
- **Option**: 옵션 항목
- **Order**: 주문 정보
- **OrderItem**: 주문 항목
- **OrderItemOption**: 주문 항목별 선택 옵션
- **OrderHistory**: 완료된 주문 이력

### 5.2 주문 ID 형식
- Auto Increment 정수 (1, 2, 3, ...)

### 5.3 주문 상태 흐름

```
PENDING(대기중) → ACCEPTED(접수) → PREPARING(준비중) → COMPLETED(완료)
```

---

## 6. API 개요

### 6.1 고객용 API

- `POST /api/tables/login` - 테이블 로그인
- `GET /api/menus` - 메뉴 목록 조회
- `GET /api/menus/{id}` - 메뉴 상세 조회
- `POST /api/orders` - 주문 생성
- `GET /api/orders` - 현재 세션 주문 목록

### 6.2 관리자용 API

- `POST /api/admin/login` - 관리자 로그인
- `POST /api/admin/register` - 관리자 등록
- `GET /api/admin/orders/stream` - SSE 주문 스트림
- `PATCH /api/admin/orders/{id}/status` - 주문 상태 변경
- `DELETE /api/admin/orders/{id}` - 주문 삭제
- `POST /api/admin/tables/{id}/complete` - 테이블 이용 완료
- `GET /api/admin/tables/{id}/history` - 과거 주문 조회
- CRUD: `/api/admin/menus`, `/api/admin/categories`, `/api/admin/options`

---

## 7. 샘플 데이터 요구사항

초기 데이터 포함:

- 1개 매장 + 기본 관리자 계정
- 3-5개 카테고리 (예: 메인, 사이드, 음료, 디저트)
- 카테고리별 3-5개 메뉴
- 일부 메뉴에 옵션 그룹 (예: 맵기 선택, 토핑 추가)
- 5-10개 테이블
